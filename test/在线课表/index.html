<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在线课表管理系统</title>
    
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- TDesign Vue CDN -->
    <link rel="stylesheet" href="https://unpkg.com/tdesign-vue-next/dist/tdesign.css">
    
    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- TDesign Vue Next CDN -->
    <script src="https://unpkg.com/tdesign-vue-next/dist/tdesign.min.js"></script>
    
    <style>
        /* 自定义样式 */
        .schedule-grid {
            display: grid;
            grid-template-columns: 80px repeat(7, 1fr);
            grid-template-rows: 60px repeat(12, 1fr);
            gap: 1px;
            background-color: #f0f0f0;
            min-height: 800px;
        }
        
        .time-cell {
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #666;
            border-right: 2px solid #e0e0e0;
        }
        
        .day-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
        }
        
        .schedule-cell {
            background-color: white;
            border: 1px solid #e0e0e0;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .schedule-cell:hover {
            background-color: #f0f8ff;
            border-color: #4facfe;
        }
        
        .course-card {
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            border-radius: 8px;
            padding: 8px;
            color: white;
            font-size: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .course-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }
        
        .course-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .course-info {
            font-size: 10px;
            opacity: 0.9;
        }
        
        /* 学科颜色 */
        .subject-math { background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); }
        .subject-chinese { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .subject-english { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
        .subject-physics { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .subject-chemistry { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .subject-biology { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .subject-other { background: linear-gradient(135deg, #fad0c4 0%, #ffd1ff 100%); }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .schedule-grid {
                grid-template-columns: 60px repeat(7, 1fr);
                gap: 0.5px;
                min-height: 600px;
            }
            
            .course-card {
                padding: 4px;
                font-size: 10px;
            }
            
            .course-name {
                margin-bottom: 2px;
            }
            
            .course-info {
                font-size: 8px;
            }
        }
        
        .floating-add-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- 头部标题 -->
        <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 shadow-lg">
            <h1 class="text-3xl font-bold text-center mb-2">📚 在线课表管理系统</h1>
            <p class="text-center text-blue-100">轻松管理您的学习时间</p>
        </div>
        
        <!-- 操作按钮栏 -->
        <div class="bg-white p-4 shadow-sm border-b flex justify-between items-center">
            <div class="flex space-x-4">
                <t-button theme="primary" @click="showAddDialog = true">
                    ➕ 添加课程
                </t-button>
                <t-button theme="default" @click="clearAllCourses">
                    🗑️ 清空课表
                </t-button>
                <t-button theme="success" @click="exportData">
                    📁 导出数据
                </t-button>
            </div>
            <div class="text-sm text-gray-600">
                提示：双击空白格快速添加课程
            </div>
        </div>
        
        <!-- 课表网格 -->
        <div class="p-4 bg-gray-50">
            <div class="schedule-grid bg-white rounded-lg shadow-lg overflow-hidden">
                <!-- 左上角空白 -->
                <div class="bg-gray-100"></div>
                
                <!-- 星期标题 -->
                <div v-for="day in weekDays" :key="day" class="day-header">
                    {{ day }}
                </div>
                
                <!-- 时间轴和课程格子 -->
                <template v-for="(timeSlot, timeIndex) in timeSlots" :key="timeIndex">
                    <!-- 时间标签 -->
                    <div class="time-cell">{{ timeSlot }}</div>
                    
                    <!-- 每天的课程格子 -->
                    <div 
                        v-for="(day, dayIndex) in 7" 
                        :key="`${timeIndex}-${dayIndex}`"
                        class="schedule-cell"
                        @dblclick="quickAddCourse(dayIndex + 1, timeIndex)"
                    >
                        <!-- 课程卡片 -->
                        <div 
                            v-if="getCourseAtTime(dayIndex + 1, timeIndex)"
                            class="course-card"
                            :class="getSubjectClass(getCourseAtTime(dayIndex + 1, timeIndex).subject)"
                            @click="editCourse(getCourseAtTime(dayIndex + 1, timeIndex))"
                        >
                            <div class="course-name">
                                {{ getCourseAtTime(dayIndex + 1, timeIndex).name }}
                            </div>
                            <div class="course-info">
                                📍 {{ getCourseAtTime(dayIndex + 1, timeIndex).location }}
                            </div>
                            <div class="course-info">
                                👨‍🏫 {{ getCourseAtTime(dayIndex + 1, timeIndex).teacher }}
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>
        
        <!-- 添加/编辑课程对话框 -->
        <t-dialog 
            v-model:visible="showAddDialog" 
            :header="isEditMode ? '编辑课程' : '添加课程'"
            width="500px"
            @confirm="saveCourse"
            @cancel="resetForm"
        >
            <t-form ref="courseForm" :data="courseForm" layout="vertical">
                <t-form-item label="课程名称" name="name">
                    <t-input v-model="courseForm.name" placeholder="请输入课程名称" />
                </t-form-item>
                
                <t-form-item label="学科类型" name="subject">
                    <t-select v-model="courseForm.subject" placeholder="请选择学科类型">
                        <t-option 
                            v-for="subject in subjects" 
                            :key="subject.value" 
                            :value="subject.value" 
                            :label="subject.label"
                        />
                    </t-select>
                </t-form-item>
                
                <t-form-item label="教师姓名" name="teacher">
                    <t-input v-model="courseForm.teacher" placeholder="请输入教师姓名" />
                </t-form-item>
                
                <t-form-item label="上课地点" name="location">
                    <t-input v-model="courseForm.location" placeholder="请输入上课地点" />
                </t-form-item>
                
                <t-form-item label="星期" name="dayOfWeek">
                    <t-select v-model="courseForm.dayOfWeek" placeholder="请选择星期">
                        <t-option 
                            v-for="(day, index) in weekDays" 
                            :key="index + 1" 
                            :value="index + 1" 
                            :label="day"
                        />
                    </t-select>
                </t-form-item>
                
                <t-form-item label="开始时间" name="startTime">
                    <t-select v-model="courseForm.startTime" placeholder="请选择开始时间">
                        <t-option 
                            v-for="(time, index) in timeSlots" 
                            :key="index" 
                            :value="index" 
                            :label="time"
                        />
                    </t-select>
                </t-form-item>
                
                <t-form-item label="结束时间" name="endTime">
                    <t-select v-model="courseForm.endTime" placeholder="请选择结束时间">
                        <t-option 
                            v-for="(time, index) in timeSlots" 
                            :key="index" 
                            :value="index" 
                            :label="time"
                            :disabled="index <= courseForm.startTime"
                        />
                    </t-select>
                </t-form-item>
            </t-form>
            
            <!-- 编辑模式下显示删除按钮 -->
            <div v-if="isEditMode" class="mt-4 flex justify-between">
                <t-button theme="danger" @click="deleteCourse">
                    🗑️ 删除课程
                </t-button>
            </div>
        </t-dialog>
        
        <!-- 浮动添加按钮 -->
        <t-button 
            class="floating-add-btn" 
            theme="primary" 
            shape="circle" 
            size="large"
            @click="showAddDialog = true"
        >
            ➕
        </t-button>
    </div>

    <script>
        const { createApp } = Vue;
        const { MessagePlugin } = TDesign;
        
        createApp({
            setup() {
                // 响应式数据定义
                const showAddDialog = Vue.ref(false);
                const isEditMode = Vue.ref(false);
                const currentEditId = Vue.ref(null);
                const courses = Vue.ref([]);
                
                // 星期数据
                const weekDays = ['周一', '周二', '周三', '周四', '周五', '周六', '周日'];
                
                // 时间段数据 (8:00-20:00)
                const timeSlots = [
                    '08:00', '09:00', '10:00', '11:00', '12:00', '13:00',
                    '14:00', '15:00', '16:00', '17:00', '18:00', '19:00'
                ];
                
                // 学科类型数据
                const subjects = [
                    { label: '📊 数学', value: 'math' },
                    { label: '📝 语文', value: 'chinese' },
                    { label: '🌍 英语', value: 'english' },
                    { label: '⚡ 物理', value: 'physics' },
                    { label: '🧪 化学', value: 'chemistry' },
                    { label: '🧬 生物', value: 'biology' },
                    { label: '📚 其他', value: 'other' }
                ];
                
                // 课程表单数据
                const courseForm = Vue.ref({
                    name: '',
                    subject: '',
                    teacher: '',
                    location: '',
                    dayOfWeek: null,
                    startTime: null,
                    endTime: null
                });
                
                /**
                 * 根据学科类型获取CSS类名
                 * @param {string} subject - 学科类型
                 * @return {string} CSS类名
                 */
                const getSubjectClass = (subject) => {
                    return `subject-${subject}`;
                };
                
                /**
                 * 获取指定时间和星期的课程
                 * @param {number} dayOfWeek - 星期几 (1-7)
                 * @param {number} timeIndex - 时间索引
                 * @return {Object|null} 课程对象或null
                 */
                const getCourseAtTime = (dayOfWeek, timeIndex) => {
                    return courses.value.find(course => 
                        course.dayOfWeek === dayOfWeek && 
                        course.startTime <= timeIndex && 
                        course.endTime > timeIndex
                    );
                };
                
                /**
                 * 检查时间冲突
                 * @param {Object} newCourse - 新课程对象
                 * @param {string} excludeId - 排除的课程ID (编辑时使用)
                 * @return {boolean} 是否存在冲突
                 */
                const checkTimeConflict = (newCourse, excludeId = null) => {
                    return courses.value.some(course => {
                        if (course.id === excludeId) return false;
                        
                        return course.dayOfWeek === newCourse.dayOfWeek &&
                               ((newCourse.startTime >= course.startTime && newCourse.startTime < course.endTime) ||
                                (newCourse.endTime > course.startTime && newCourse.endTime <= course.endTime) ||
                                (newCourse.startTime <= course.startTime && newCourse.endTime >= course.endTime));
                    });
                };
                
                /**
                 * 快速添加课程 (双击空白格)
                 * @param {number} dayOfWeek - 星期几
                 * @param {number} timeIndex - 时间索引
                 */
                const quickAddCourse = (dayOfWeek, timeIndex) => {
                    // 检查该时间段是否已有课程
                    if (getCourseAtTime(dayOfWeek, timeIndex)) {
                        MessagePlugin.warning('该时间段已有课程，请选择其他时间');
                        return;
                    }
                    
                    // 预填表单数据
                    courseForm.value = {
                        name: '',
                        subject: '',
                        teacher: '',
                        location: '',
                        dayOfWeek: dayOfWeek,
                        startTime: timeIndex,
                        endTime: timeIndex + 1
                    };
                    
                    isEditMode.value = false;
                    showAddDialog.value = true;
                };
                
                /**
                 * 编辑课程
                 * @param {Object} course - 课程对象
                 */
                const editCourse = (course) => {
                    courseForm.value = { ...course };
                    currentEditId.value = course.id;
                    isEditMode.value = true;
                    showAddDialog.value = true;
                };
                
                /**
                 * 保存课程 (添加或编辑)
                 */
                const saveCourse = () => {
                    // 表单验证
                    if (!courseForm.value.name.trim()) {
                        MessagePlugin.error('请输入课程名称');
                        return;
                    }
                    
                    if (!courseForm.value.subject) {
                        MessagePlugin.error('请选择学科类型');
                        return;
                    }
                    
                    if (courseForm.value.dayOfWeek === null) {
                        MessagePlugin.error('请选择星期');
                        return;
                    }
                    
                    if (courseForm.value.startTime === null || courseForm.value.endTime === null) {
                        MessagePlugin.error('请选择时间');
                        return;
                    }
                    
                    if (courseForm.value.startTime >= courseForm.value.endTime) {
                        MessagePlugin.error('结束时间必须大于开始时间');
                        return;
                    }
                    
                    // 检查时间冲突
                    if (checkTimeConflict(courseForm.value, currentEditId.value)) {
                        MessagePlugin.error('时间冲突，请选择其他时间段');
                        return;
                    }
                    
                    if (isEditMode.value) {
                        // 编辑模式：更新现有课程
                        const index = courses.value.findIndex(c => c.id === currentEditId.value);
                        if (index !== -1) {
                            courses.value[index] = { ...courseForm.value, id: currentEditId.value };
                            MessagePlugin.success('课程更新成功！');
                        }
                    } else {
                        // 添加模式：创建新课程
                        const newCourse = {
                            ...courseForm.value,
                            id: Date.now().toString() // 使用时间戳作为唯一ID
                        };
                        courses.value.push(newCourse);
                        MessagePlugin.success('课程添加成功！');
                    }
                    
                    // 保存到本地存储
                    saveToLocalStorage();
                    
                    // 关闭对话框并重置表单
                    showAddDialog.value = false;
                    resetForm();
                };
                
                /**
                 * 删除课程
                 */
                const deleteCourse = () => {
                    const index = courses.value.findIndex(c => c.id === currentEditId.value);
                    if (index !== -1) {
                        courses.value.splice(index, 1);
                        saveToLocalStorage();
                        MessagePlugin.success('课程删除成功！');
                        showAddDialog.value = false;
                        resetForm();
                    }
                };
                
                /**
                 * 重置表单
                 */
                const resetForm = () => {
                    courseForm.value = {
                        name: '',
                        subject: '',
                        teacher: '',
                        location: '',
                        dayOfWeek: null,
                        startTime: null,
                        endTime: null
                    };
                    isEditMode.value = false;
                    currentEditId.value = null;
                };
                
                /**
                 * 清空所有课程
                 */
                const clearAllCourses = () => {
                    if (confirm('确定要清空所有课程吗？此操作不可恢复。')) {
                        courses.value = [];
                        saveToLocalStorage();
                        MessagePlugin.success('课表已清空');
                    }
                };
                
                /**
                 * 导出数据
                 */
                const exportData = () => {
                    const dataStr = JSON.stringify(courses.value, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `课表数据_${new Date().toISOString().slice(0, 10)}.json`;
                    link.click();
                    URL.revokeObjectURL(url);
                    MessagePlugin.success('数据导出成功！');
                };
                
                /**
                 * 保存数据到本地存储
                 */
                const saveToLocalStorage = () => {
                    localStorage.setItem('schedule-courses', JSON.stringify(courses.value));
                };
                
                /**
                 * 从本地存储加载数据
                 */
                const loadFromLocalStorage = () => {
                    const saved = localStorage.getItem('schedule-courses');
                    if (saved) {
                        try {
                            courses.value = JSON.parse(saved);
                        } catch (error) {
                            console.error('加载本地数据失败:', error);
                            MessagePlugin.error('加载本地数据失败');
                        }
                    }
                };
                
                // 组件挂载时加载数据
                Vue.onMounted(() => {
                    loadFromLocalStorage();
                });
                
                // 返回所有响应式数据和方法
                return {
                    // 响应式数据
                    showAddDialog,
                    isEditMode,
                    courses,
                    courseForm,
                    weekDays,
                    timeSlots,
                    subjects,
                    
                    // 方法
                    getSubjectClass,
                    getCourseAtTime,
                    quickAddCourse,
                    editCourse,
                    saveCourse,
                    deleteCourse,
                    resetForm,
                    clearAllCourses,
                    exportData
                };
            }
        }).use(TDesign).mount('#app');
    </script>
</body>
</html>