<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ¨çº¿è¯¾è¡¨ç®¡ç†ç³»ç»Ÿ</title>
    
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- TDesign Vue CDN -->
    <link rel="stylesheet" href="https://unpkg.com/tdesign-vue-next/dist/tdesign.css">
    
    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- TDesign Vue Next CDN -->
    <script src="https://unpkg.com/tdesign-vue-next/dist/tdesign.min.js"></script>
    
    <style>
        /* è‡ªå®šä¹‰æ ·å¼ */
        .schedule-grid {
            display: grid;
            grid-template-columns: 80px repeat(7, 1fr);
            grid-template-rows: 60px repeat(12, 1fr);
            gap: 1px;
            background-color: #f0f0f0;
            min-height: 800px;
        }
        
        .time-cell {
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #666;
            border-right: 2px solid #e0e0e0;
        }
        
        .day-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
        }
        
        .schedule-cell {
            background-color: white;
            border: 1px solid #e0e0e0;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .schedule-cell:hover {
            background-color: #f0f8ff;
            border-color: #4facfe;
        }
        
        .course-card {
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            border-radius: 8px;
            padding: 8px;
            color: white;
            font-size: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .course-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }
        
        .course-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .course-info {
            font-size: 10px;
            opacity: 0.9;
        }
        
        /* å­¦ç§‘é¢œè‰² */
        .subject-math { background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); }
        .subject-chinese { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .subject-english { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
        .subject-physics { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .subject-chemistry { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .subject-biology { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .subject-other { background: linear-gradient(135deg, #fad0c4 0%, #ffd1ff 100%); }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .schedule-grid {
                grid-template-columns: 60px repeat(7, 1fr);
                gap: 0.5px;
                min-height: 600px;
            }
            
            .course-card {
                padding: 4px;
                font-size: 10px;
            }
            
            .course-name {
                margin-bottom: 2px;
            }
            
            .course-info {
                font-size: 8px;
            }
        }
        
        .floating-add-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- å¤´éƒ¨æ ‡é¢˜ -->
        <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 shadow-lg">
            <h1 class="text-3xl font-bold text-center mb-2">ğŸ“š åœ¨çº¿è¯¾è¡¨ç®¡ç†ç³»ç»Ÿ</h1>
            <p class="text-center text-blue-100">è½»æ¾ç®¡ç†æ‚¨çš„å­¦ä¹ æ—¶é—´</p>
        </div>
        
        <!-- æ“ä½œæŒ‰é’®æ  -->
        <div class="bg-white p-4 shadow-sm border-b flex justify-between items-center">
            <div class="flex space-x-4">
                <t-button theme="primary" @click="showAddDialog = true">
                    â• æ·»åŠ è¯¾ç¨‹
                </t-button>
                <t-button theme="default" @click="clearAllCourses">
                    ğŸ—‘ï¸ æ¸…ç©ºè¯¾è¡¨
                </t-button>
                <t-button theme="success" @click="exportData">
                    ğŸ“ å¯¼å‡ºæ•°æ®
                </t-button>
            </div>
            <div class="text-sm text-gray-600">
                æç¤ºï¼šåŒå‡»ç©ºç™½æ ¼å¿«é€Ÿæ·»åŠ è¯¾ç¨‹
            </div>
        </div>
        
        <!-- è¯¾è¡¨ç½‘æ ¼ -->
        <div class="p-4 bg-gray-50">
            <div class="schedule-grid bg-white rounded-lg shadow-lg overflow-hidden">
                <!-- å·¦ä¸Šè§’ç©ºç™½ -->
                <div class="bg-gray-100"></div>
                
                <!-- æ˜ŸæœŸæ ‡é¢˜ -->
                <div v-for="day in weekDays" :key="day" class="day-header">
                    {{ day }}
                </div>
                
                <!-- æ—¶é—´è½´å’Œè¯¾ç¨‹æ ¼å­ -->
                <template v-for="(timeSlot, timeIndex) in timeSlots" :key="timeIndex">
                    <!-- æ—¶é—´æ ‡ç­¾ -->
                    <div class="time-cell">{{ timeSlot }}</div>
                    
                    <!-- æ¯å¤©çš„è¯¾ç¨‹æ ¼å­ -->
                    <div 
                        v-for="(day, dayIndex) in 7" 
                        :key="`${timeIndex}-${dayIndex}`"
                        class="schedule-cell"
                        @dblclick="quickAddCourse(dayIndex + 1, timeIndex)"
                    >
                        <!-- è¯¾ç¨‹å¡ç‰‡ -->
                        <div 
                            v-if="getCourseAtTime(dayIndex + 1, timeIndex)"
                            class="course-card"
                            :class="getSubjectClass(getCourseAtTime(dayIndex + 1, timeIndex).subject)"
                            @click="editCourse(getCourseAtTime(dayIndex + 1, timeIndex))"
                        >
                            <div class="course-name">
                                {{ getCourseAtTime(dayIndex + 1, timeIndex).name }}
                            </div>
                            <div class="course-info">
                                ğŸ“ {{ getCourseAtTime(dayIndex + 1, timeIndex).location }}
                            </div>
                            <div class="course-info">
                                ğŸ‘¨â€ğŸ« {{ getCourseAtTime(dayIndex + 1, timeIndex).teacher }}
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>
        
        <!-- æ·»åŠ /ç¼–è¾‘è¯¾ç¨‹å¯¹è¯æ¡† -->
        <t-dialog 
            v-model:visible="showAddDialog" 
            :header="isEditMode ? 'ç¼–è¾‘è¯¾ç¨‹' : 'æ·»åŠ è¯¾ç¨‹'"
            width="500px"
            @confirm="saveCourse"
            @cancel="resetForm"
        >
            <t-form ref="courseForm" :data="courseForm" layout="vertical">
                <t-form-item label="è¯¾ç¨‹åç§°" name="name">
                    <t-input v-model="courseForm.name" placeholder="è¯·è¾“å…¥è¯¾ç¨‹åç§°" />
                </t-form-item>
                
                <t-form-item label="å­¦ç§‘ç±»å‹" name="subject">
                    <t-select v-model="courseForm.subject" placeholder="è¯·é€‰æ‹©å­¦ç§‘ç±»å‹">
                        <t-option 
                            v-for="subject in subjects" 
                            :key="subject.value" 
                            :value="subject.value" 
                            :label="subject.label"
                        />
                    </t-select>
                </t-form-item>
                
                <t-form-item label="æ•™å¸ˆå§“å" name="teacher">
                    <t-input v-model="courseForm.teacher" placeholder="è¯·è¾“å…¥æ•™å¸ˆå§“å" />
                </t-form-item>
                
                <t-form-item label="ä¸Šè¯¾åœ°ç‚¹" name="location">
                    <t-input v-model="courseForm.location" placeholder="è¯·è¾“å…¥ä¸Šè¯¾åœ°ç‚¹" />
                </t-form-item>
                
                <t-form-item label="æ˜ŸæœŸ" name="dayOfWeek">
                    <t-select v-model="courseForm.dayOfWeek" placeholder="è¯·é€‰æ‹©æ˜ŸæœŸ">
                        <t-option 
                            v-for="(day, index) in weekDays" 
                            :key="index + 1" 
                            :value="index + 1" 
                            :label="day"
                        />
                    </t-select>
                </t-form-item>
                
                <t-form-item label="å¼€å§‹æ—¶é—´" name="startTime">
                    <t-select v-model="courseForm.startTime" placeholder="è¯·é€‰æ‹©å¼€å§‹æ—¶é—´">
                        <t-option 
                            v-for="(time, index) in timeSlots" 
                            :key="index" 
                            :value="index" 
                            :label="time"
                        />
                    </t-select>
                </t-form-item>
                
                <t-form-item label="ç»“æŸæ—¶é—´" name="endTime">
                    <t-select v-model="courseForm.endTime" placeholder="è¯·é€‰æ‹©ç»“æŸæ—¶é—´">
                        <t-option 
                            v-for="(time, index) in timeSlots" 
                            :key="index" 
                            :value="index" 
                            :label="time"
                            :disabled="index <= courseForm.startTime"
                        />
                    </t-select>
                </t-form-item>
            </t-form>
            
            <!-- ç¼–è¾‘æ¨¡å¼ä¸‹æ˜¾ç¤ºåˆ é™¤æŒ‰é’® -->
            <div v-if="isEditMode" class="mt-4 flex justify-between">
                <t-button theme="danger" @click="deleteCourse">
                    ğŸ—‘ï¸ åˆ é™¤è¯¾ç¨‹
                </t-button>
            </div>
        </t-dialog>
        
        <!-- æµ®åŠ¨æ·»åŠ æŒ‰é’® -->
        <t-button 
            class="floating-add-btn" 
            theme="primary" 
            shape="circle" 
            size="large"
            @click="showAddDialog = true"
        >
            â•
        </t-button>
    </div>

    <script>
        const { createApp } = Vue;
        const { MessagePlugin } = TDesign;
        
        createApp({
            setup() {
                // å“åº”å¼æ•°æ®å®šä¹‰
                const showAddDialog = Vue.ref(false);
                const isEditMode = Vue.ref(false);
                const currentEditId = Vue.ref(null);
                const courses = Vue.ref([]);
                
                // æ˜ŸæœŸæ•°æ®
                const weekDays = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
                
                // æ—¶é—´æ®µæ•°æ® (8:00-20:00)
                const timeSlots = [
                    '08:00', '09:00', '10:00', '11:00', '12:00', '13:00',
                    '14:00', '15:00', '16:00', '17:00', '18:00', '19:00'
                ];
                
                // å­¦ç§‘ç±»å‹æ•°æ®
                const subjects = [
                    { label: 'ğŸ“Š æ•°å­¦', value: 'math' },
                    { label: 'ğŸ“ è¯­æ–‡', value: 'chinese' },
                    { label: 'ğŸŒ è‹±è¯­', value: 'english' },
                    { label: 'âš¡ ç‰©ç†', value: 'physics' },
                    { label: 'ğŸ§ª åŒ–å­¦', value: 'chemistry' },
                    { label: 'ğŸ§¬ ç”Ÿç‰©', value: 'biology' },
                    { label: 'ğŸ“š å…¶ä»–', value: 'other' }
                ];
                
                // è¯¾ç¨‹è¡¨å•æ•°æ®
                const courseForm = Vue.ref({
                    name: '',
                    subject: '',
                    teacher: '',
                    location: '',
                    dayOfWeek: null,
                    startTime: null,
                    endTime: null
                });
                
                /**
                 * æ ¹æ®å­¦ç§‘ç±»å‹è·å–CSSç±»å
                 * @param {string} subject - å­¦ç§‘ç±»å‹
                 * @return {string} CSSç±»å
                 */
                const getSubjectClass = (subject) => {
                    return `subject-${subject}`;
                };
                
                /**
                 * è·å–æŒ‡å®šæ—¶é—´å’Œæ˜ŸæœŸçš„è¯¾ç¨‹
                 * @param {number} dayOfWeek - æ˜ŸæœŸå‡  (1-7)
                 * @param {number} timeIndex - æ—¶é—´ç´¢å¼•
                 * @return {Object|null} è¯¾ç¨‹å¯¹è±¡æˆ–null
                 */
                const getCourseAtTime = (dayOfWeek, timeIndex) => {
                    return courses.value.find(course => 
                        course.dayOfWeek === dayOfWeek && 
                        course.startTime <= timeIndex && 
                        course.endTime > timeIndex
                    );
                };
                
                /**
                 * æ£€æŸ¥æ—¶é—´å†²çª
                 * @param {Object} newCourse - æ–°è¯¾ç¨‹å¯¹è±¡
                 * @param {string} excludeId - æ’é™¤çš„è¯¾ç¨‹ID (ç¼–è¾‘æ—¶ä½¿ç”¨)
                 * @return {boolean} æ˜¯å¦å­˜åœ¨å†²çª
                 */
                const checkTimeConflict = (newCourse, excludeId = null) => {
                    return courses.value.some(course => {
                        if (course.id === excludeId) return false;
                        
                        return course.dayOfWeek === newCourse.dayOfWeek &&
                               ((newCourse.startTime >= course.startTime && newCourse.startTime < course.endTime) ||
                                (newCourse.endTime > course.startTime && newCourse.endTime <= course.endTime) ||
                                (newCourse.startTime <= course.startTime && newCourse.endTime >= course.endTime));
                    });
                };
                
                /**
                 * å¿«é€Ÿæ·»åŠ è¯¾ç¨‹ (åŒå‡»ç©ºç™½æ ¼)
                 * @param {number} dayOfWeek - æ˜ŸæœŸå‡ 
                 * @param {number} timeIndex - æ—¶é—´ç´¢å¼•
                 */
                const quickAddCourse = (dayOfWeek, timeIndex) => {
                    // æ£€æŸ¥è¯¥æ—¶é—´æ®µæ˜¯å¦å·²æœ‰è¯¾ç¨‹
                    if (getCourseAtTime(dayOfWeek, timeIndex)) {
                        MessagePlugin.warning('è¯¥æ—¶é—´æ®µå·²æœ‰è¯¾ç¨‹ï¼Œè¯·é€‰æ‹©å…¶ä»–æ—¶é—´');
                        return;
                    }
                    
                    // é¢„å¡«è¡¨å•æ•°æ®
                    courseForm.value = {
                        name: '',
                        subject: '',
                        teacher: '',
                        location: '',
                        dayOfWeek: dayOfWeek,
                        startTime: timeIndex,
                        endTime: timeIndex + 1
                    };
                    
                    isEditMode.value = false;
                    showAddDialog.value = true;
                };
                
                /**
                 * ç¼–è¾‘è¯¾ç¨‹
                 * @param {Object} course - è¯¾ç¨‹å¯¹è±¡
                 */
                const editCourse = (course) => {
                    courseForm.value = { ...course };
                    currentEditId.value = course.id;
                    isEditMode.value = true;
                    showAddDialog.value = true;
                };
                
                /**
                 * ä¿å­˜è¯¾ç¨‹ (æ·»åŠ æˆ–ç¼–è¾‘)
                 */
                const saveCourse = () => {
                    // è¡¨å•éªŒè¯
                    if (!courseForm.value.name.trim()) {
                        MessagePlugin.error('è¯·è¾“å…¥è¯¾ç¨‹åç§°');
                        return;
                    }
                    
                    if (!courseForm.value.subject) {
                        MessagePlugin.error('è¯·é€‰æ‹©å­¦ç§‘ç±»å‹');
                        return;
                    }
                    
                    if (courseForm.value.dayOfWeek === null) {
                        MessagePlugin.error('è¯·é€‰æ‹©æ˜ŸæœŸ');
                        return;
                    }
                    
                    if (courseForm.value.startTime === null || courseForm.value.endTime === null) {
                        MessagePlugin.error('è¯·é€‰æ‹©æ—¶é—´');
                        return;
                    }
                    
                    if (courseForm.value.startTime >= courseForm.value.endTime) {
                        MessagePlugin.error('ç»“æŸæ—¶é—´å¿…é¡»å¤§äºå¼€å§‹æ—¶é—´');
                        return;
                    }
                    
                    // æ£€æŸ¥æ—¶é—´å†²çª
                    if (checkTimeConflict(courseForm.value, currentEditId.value)) {
                        MessagePlugin.error('æ—¶é—´å†²çªï¼Œè¯·é€‰æ‹©å…¶ä»–æ—¶é—´æ®µ');
                        return;
                    }
                    
                    if (isEditMode.value) {
                        // ç¼–è¾‘æ¨¡å¼ï¼šæ›´æ–°ç°æœ‰è¯¾ç¨‹
                        const index = courses.value.findIndex(c => c.id === currentEditId.value);
                        if (index !== -1) {
                            courses.value[index] = { ...courseForm.value, id: currentEditId.value };
                            MessagePlugin.success('è¯¾ç¨‹æ›´æ–°æˆåŠŸï¼');
                        }
                    } else {
                        // æ·»åŠ æ¨¡å¼ï¼šåˆ›å»ºæ–°è¯¾ç¨‹
                        const newCourse = {
                            ...courseForm.value,
                            id: Date.now().toString() // ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºå”¯ä¸€ID
                        };
                        courses.value.push(newCourse);
                        MessagePlugin.success('è¯¾ç¨‹æ·»åŠ æˆåŠŸï¼');
                    }
                    
                    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                    saveToLocalStorage();
                    
                    // å…³é—­å¯¹è¯æ¡†å¹¶é‡ç½®è¡¨å•
                    showAddDialog.value = false;
                    resetForm();
                };
                
                /**
                 * åˆ é™¤è¯¾ç¨‹
                 */
                const deleteCourse = () => {
                    const index = courses.value.findIndex(c => c.id === currentEditId.value);
                    if (index !== -1) {
                        courses.value.splice(index, 1);
                        saveToLocalStorage();
                        MessagePlugin.success('è¯¾ç¨‹åˆ é™¤æˆåŠŸï¼');
                        showAddDialog.value = false;
                        resetForm();
                    }
                };
                
                /**
                 * é‡ç½®è¡¨å•
                 */
                const resetForm = () => {
                    courseForm.value = {
                        name: '',
                        subject: '',
                        teacher: '',
                        location: '',
                        dayOfWeek: null,
                        startTime: null,
                        endTime: null
                    };
                    isEditMode.value = false;
                    currentEditId.value = null;
                };
                
                /**
                 * æ¸…ç©ºæ‰€æœ‰è¯¾ç¨‹
                 */
                const clearAllCourses = () => {
                    if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è¯¾ç¨‹å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                        courses.value = [];
                        saveToLocalStorage();
                        MessagePlugin.success('è¯¾è¡¨å·²æ¸…ç©º');
                    }
                };
                
                /**
                 * å¯¼å‡ºæ•°æ®
                 */
                const exportData = () => {
                    const dataStr = JSON.stringify(courses.value, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `è¯¾è¡¨æ•°æ®_${new Date().toISOString().slice(0, 10)}.json`;
                    link.click();
                    URL.revokeObjectURL(url);
                    MessagePlugin.success('æ•°æ®å¯¼å‡ºæˆåŠŸï¼');
                };
                
                /**
                 * ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
                 */
                const saveToLocalStorage = () => {
                    localStorage.setItem('schedule-courses', JSON.stringify(courses.value));
                };
                
                /**
                 * ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
                 */
                const loadFromLocalStorage = () => {
                    const saved = localStorage.getItem('schedule-courses');
                    if (saved) {
                        try {
                            courses.value = JSON.parse(saved);
                        } catch (error) {
                            console.error('åŠ è½½æœ¬åœ°æ•°æ®å¤±è´¥:', error);
                            MessagePlugin.error('åŠ è½½æœ¬åœ°æ•°æ®å¤±è´¥');
                        }
                    }
                };
                
                // ç»„ä»¶æŒ‚è½½æ—¶åŠ è½½æ•°æ®
                Vue.onMounted(() => {
                    loadFromLocalStorage();
                });
                
                // è¿”å›æ‰€æœ‰å“åº”å¼æ•°æ®å’Œæ–¹æ³•
                return {
                    // å“åº”å¼æ•°æ®
                    showAddDialog,
                    isEditMode,
                    courses,
                    courseForm,
                    weekDays,
                    timeSlots,
                    subjects,
                    
                    // æ–¹æ³•
                    getSubjectClass,
                    getCourseAtTime,
                    quickAddCourse,
                    editCourse,
                    saveCourse,
                    deleteCourse,
                    resetForm,
                    clearAllCourses,
                    exportData
                };
            }
        }).use(TDesign).mount('#app');
    </script>
</body>
</html>