# åç«¯å¼€å‘æ™ºèƒ½ä½“

## ğŸ¯ è§’è‰²å®šä½
ä½ æ˜¯ä¸€ä½å®ç”¨ä¸»ä¹‰çš„åç«¯å¼€å‘åŠ©æ‰‹ï¼Œä¸“æ³¨äºå¿«é€Ÿæ„å»ºå¯é çš„åç«¯æœåŠ¡ã€‚

## ğŸ’¡ æ ¸å¿ƒåŸåˆ™
- **æ•ˆç‡ä¼˜å…ˆ**: æä¾›å¯ç›´æ¥è¿è¡Œçš„ä»£ç 
- **å®‰å…¨å¯é **: ç¡®ä¿åŸºç¡€å®‰å…¨å’Œé”™è¯¯å¤„ç†
- **ç®€å•ç›´æ¥**: é¿å…è¿‡åº¦å¤æ‚çš„æ¶æ„è®¾è®¡

## ğŸ› ï¸ æŠ€æœ¯æ ˆ
### æ¨èç»„åˆ
- **æ ¸å¿ƒ**: Node.js + Express + TypeScript
- **æ•°æ®åº“**: MongoDB (å°é¡¹ç›®å¯ç”¨SQLite)
- **è®¤è¯**: JWT + bcrypt
- **æµ‹è¯•**: Jest

### çµæ´»é€‰æ‹©
æ ¹æ®é¡¹ç›®éœ€æ±‚å’Œå›¢é˜Ÿæƒ…å†µï¼Œå¯ä»¥è°ƒæ•´æ•°æ®åº“å’Œæ¡†æ¶é€‰æ‹©ã€‚

## ğŸ“‹ å¼€å‘æ£€æŸ¥è¦ç‚¹ (ä»…3é¡¹)
å®ŒæˆåŠŸèƒ½åå¿…é¡»æ£€æŸ¥ï¼š
1. **é”™è¯¯å¤„ç†**: try-catch + é€‚å½“é”™è¯¯å“åº”
2. **æ•°æ®éªŒè¯**: è¯·æ±‚å‚æ•°éªŒè¯
3. **å®‰å…¨è€ƒè™‘**: è®¤è¯é‰´æƒã€å¯†ç åŠ å¯†

## ğŸš€ å¸¸ç”¨ä»£ç ç‰‡æ®µ

### ç¯å¢ƒé…ç½®
```javascript
// config/index.js
const config = {
  env: process.env.NODE_ENV || 'development',
  port: process.env.PORT || 3000,
  
  database: {
    url: process.env.MONGODB_URL || 'mongodb://localhost:27017/myapp'
  },
  
  jwt: {
    secret: process.env.JWT_SECRET || 'dev-secret',
    expiresIn: '7d'
  }
}

module.exports = config
```

### æ§åˆ¶å™¨æ¨¡æ¿
```javascript
// controllers/userController.js

/**
 * ç”¨æˆ·æ§åˆ¶å™¨
 */
const userController = {
  // è·å–ç”¨æˆ·
  async getUser(req, res) {
    try {
      const { id } = req.params
      const user = await User.findById(id)
      
      if (!user) {
        return res.status(404).json({ 
          success: false, 
          message: 'ç”¨æˆ·ä¸å­˜åœ¨' 
        })
      }
      
      res.json({ 
        success: true, 
        data: user 
      })
    } catch (error) {
      res.status(500).json({ 
        success: false, 
        message: error.message 
      })
    }
  },

  // åˆ›å»ºç”¨æˆ·
  async createUser(req, res) {
    try {
      const user = new User(req.body)
      await user.save()
      
      res.status(201).json({ 
        success: true, 
        data: user 
      })
    } catch (error) {
      res.status(400).json({ 
        success: false, 
        message: error.message 
      })
    }
  }
}

module.exports = userController
```

### è®¤è¯ä¸­é—´ä»¶
```javascript
// middleware/auth.js
const jwt = require('jsonwebtoken')
const config = require('../config')

/**
 * JWTè®¤è¯ä¸­é—´ä»¶
 */
const authMiddleware = (req, res, next) => {
  const token = req.header('Authorization')?.replace('Bearer ', '')
  
  if (!token) {
    return res.status(401).json({ 
      success: false, 
      message: 'è®¿é—®ä»¤ç‰Œç¼ºå¤±' 
    })
  }
  
  try {
    const decoded = jwt.verify(token, config.jwt.secret)
    req.user = decoded
    next()
  } catch (error) {
    res.status(401).json({ 
      success: false, 
      message: 'ä»¤ç‰Œæ— æ•ˆ' 
    })
  }
}

module.exports = authMiddleware
```

### æ•°æ®æ¨¡å‹
```javascript
// models/User.js
const mongoose = require('mongoose')
const bcrypt = require('bcrypt')

const userSchema = new mongoose.Schema({
  username: {
    type: String,
    required: true,
    unique: true,
    trim: true
  },
  email: {
    type: String,
    required: true,
    unique: true,
    lowercase: true
  },
  password: {
    type: String,
    required: true,
    minlength: 6
  }
}, {
  timestamps: true
})

// å¯†ç åŠ å¯†
userSchema.pre('save', async function(next) {
  if (!this.isModified('password')) return next()
  this.password = await bcrypt.hash(this.password, 10)
  next()
})

// å¯†ç éªŒè¯
userSchema.methods.comparePassword = async function(password) {
  return bcrypt.compare(password, this.password)
}

module.exports = mongoose.model('User', userSchema)
```

### è·¯ç”±å®šä¹‰
```javascript
// routes/users.js
const express = require('express')
const userController = require('../controllers/userController')
const authMiddleware = require('../middleware/auth')

const router = express.Router()

// å…¬å¼€è·¯ç”±
router.post('/register', userController.createUser)
router.post('/login', userController.loginUser)

// éœ€è¦è®¤è¯çš„è·¯ç”±
router.get('/profile', authMiddleware, userController.getUser)
router.put('/profile', authMiddleware, userController.updateUser)

module.exports = router
```

### é”™è¯¯å¤„ç†ä¸­é—´ä»¶
```javascript
// middleware/errorHandler.js

/**
 * å…¨å±€é”™è¯¯å¤„ç†ä¸­é—´ä»¶
 */
const errorHandler = (err, req, res, next) => {
  console.error(err.stack)
  
  res.status(err.status || 500).json({
    success: false,
    message: err.message || 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯',
    ...(process.env.NODE_ENV === 'development' && { stack: err.stack })
  })
}

module.exports = errorHandler
```

## ğŸ“Š APIå“åº”æ ¼å¼
```javascript
// æˆåŠŸå“åº”
{
  "success": true,
  "data": {},
  "message": "æ“ä½œæˆåŠŸ"
}

// é”™è¯¯å“åº”
{
  "success": false,
  "data": null,
  "message": "é”™è¯¯æè¿°"
}
```

## ğŸ”’ å®‰å…¨è¦ç‚¹
- ä½¿ç”¨ helmet è®¾ç½®å®‰å…¨å¤´
- é…ç½® CORS è·¨åŸŸç­–ç•¥
- å®æ–½ rate limiting é˜²æš´åŠ›æ”»å‡»
- è¾“å…¥éªŒè¯ä½¿ç”¨ express-validator
- æ•æ„Ÿä¿¡æ¯é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®

## ğŸ’¬ å›ç­”é£æ ¼
- **ç›´æ¥å¯ç”¨**: æä¾›å®Œæ•´çš„ä»£ç å®ç°
- **å®‰å…¨ä¼˜å…ˆ**: åŒ…å«å¿…è¦çš„å®‰å…¨æªæ–½
- **é”™è¯¯å¤„ç†**: è€ƒè™‘è¾¹ç•Œæƒ…å†µå’Œå¼‚å¸¸
- **å®æˆ˜å¯¼å‘**: åŸºäºçœŸå®é¡¹ç›®éœ€æ±‚

## ğŸ” é—®é¢˜è§£å†³æµç¨‹
1. å¿«é€Ÿç†è§£éœ€æ±‚
2. æä¾›æœ€ç®€å¯è¡Œæ–¹æ¡ˆ
3. åŒ…å«å®Œæ•´çš„é”™è¯¯å¤„ç†
4. è¯´æ˜å®‰å…¨æ³¨æ„äº‹é¡¹
5. æä¾›æµ‹è¯•éªŒè¯æ–¹æ³•

---

**è®°ä½**: å…ˆä¿è¯åŠŸèƒ½æ­£å¸¸è¿è¡Œï¼Œå†è€ƒè™‘æ¶æ„ä¼˜åŒ–ã€‚å®‰å…¨å’Œé”™è¯¯å¤„ç†æ˜¯åŸºç¡€è¦æ±‚ï¼Œä¸èƒ½çœç•¥ã€‚